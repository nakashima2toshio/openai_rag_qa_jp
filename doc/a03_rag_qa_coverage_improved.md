# a03_rag_qa_coverage_improved.py - è©³ç´°è¨­è¨ˆæ›¸

## æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
- **æœ€çµ‚æ›´æ–°**: 2025-10-23
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.1 (å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæœ€é©åŒ–ç‰ˆ)
- **ä¸»è¦æ©Ÿèƒ½**: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹Q/Aç”Ÿæˆã€ãƒãƒƒãƒå‡¦ç†ã€å¤šæ®µéšã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æã€MeCabã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º

---

## ğŸ¯ ãƒã‚¤ãƒ©ã‚¤ãƒˆ

**ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡99.7%ã‚’å®Ÿç¾ï¼å®Ÿè¡Œæ™‚é–“ã‚ãšã‹2åˆ†ã€APIå‘¼ã³å‡ºã—ãŸã£ãŸ5å›**

- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡**: 99.7%ï¼ˆå¾“æ¥ç‰ˆ50-60%ã®2å€ï¼‰
- **å®Ÿè¡Œæ™‚é–“**: ç´„2åˆ†ï¼ˆå¾“æ¥ç‰ˆ20åˆ†ã‹ã‚‰90%çŸ­ç¸®ï¼‰
- **APIå‘¼ã³å‡ºã—**: 5å›ï¼ˆå¾“æ¥ç‰ˆ7,917å›ã‹ã‚‰99.94%å‰Šæ¸›ï¼‰
- **ã‚³ã‚¹ãƒˆ**: $0.00076ï¼ˆå¾“æ¥ç‰ˆ$0.08ã‹ã‚‰99.05%å‰Šæ¸›ï¼‰

---

## ğŸ“‹ æ¨å¥¨ã‚³ãƒãƒ³ãƒ‰

### 99.7%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆç‰ˆï¼ˆå®Ÿç¸¾å€¤ï¼‰

```bash
python a03_rag_qa_coverage_improved.py \
  --input OUTPUT/preprocessed_cc_news.csv \
  --dataset cc_news \
  --analyze-coverage \
  --coverage-threshold 0.52 \
  --qa-per-chunk 12 \
  --max-chunks 609 \
  --max-docs 150 \
  --output qa_output
```

**å®Ÿè¡Œçµæœ:**
- å‡¦ç†æ–‡æ›¸: 150ä»¶
- ãƒãƒ£ãƒ³ã‚¯æ•°: 609å€‹
- Q/Aç”Ÿæˆæ•°: 7,308å€‹
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡: 99.7%** âœ…
- **å‡¦ç†æ™‚é–“: 2åˆ†**
- **APIå‘¼ã³å‡ºã—: 5å›**
  - ãƒãƒ£ãƒ³ã‚¯åŸ‹ã‚è¾¼ã¿: 1å›
  - Q/AåŸ‹ã‚è¾¼ã¿: 4å›
  - Q/Aç”Ÿæˆ: 0å›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãŸã‚ï¼‰
- **ã‚³ã‚¹ãƒˆ: $0.00076**
- **å‡ºåŠ›å…ˆ: qa_output/a03/** â­NEW

---

## æ¦‚è¦

`a03_rag_qa_coverage_improved.py`ã¯ã€**ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡99.7%é”æˆã‚’å®Ÿè¨¼ã—ãŸæ”¹è‰¯ç‰ˆ**ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æã¨Q/Aç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚å¾“æ¥ç‰ˆï¼ˆ`a03_rag_qa_coverage.py`ï¼‰ã®èª²é¡Œã‚’æ”¹å–„ã—ã€è¶…é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸ã¨å“è³ªã®Q/Aãƒšã‚¢ã‚’è¶…ä½ã‚³ã‚¹ãƒˆã§ç”Ÿæˆã—ã¾ã™ã€‚

**v2.1ã®æ–°æ©Ÿèƒ½**:
- å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`qa_output/a03/`ã«å¤‰æ›´ï¼ˆã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè‡ªå‹•ä½œæˆï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®æ”¹å–„

---

## ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆã®ãŸã‚ã®é‡è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | é€šå¸¸å€¤ | 80%é”æˆ | 95%é”æˆ | **99.7%é”æˆï¼ˆå®Ÿç¸¾ï¼‰** | åŠ¹æœ |
|----------|--------|---------|---------|---------------------|------|
| `--qa-per-chunk` | 4-5 | 6-8 | 10-12 | **12** | Q/Aå¯†åº¦3å€ |
| `--coverage-threshold` | 0.65-0.70 | 0.60-0.65 | 0.52-0.60 | **0.52** | åˆ¤å®šåŸºæº–ç·©å’Œ |
| `--max-chunks` | 300 | 400 | 500 | **609** | å‡¦ç†ãƒãƒ£ãƒ³ã‚¯å¢— |
| `--max-docs` | 50-100 | 100 | 150 | **150** | å…¨æ–‡æ›¸å‡¦ç† |

### å¾“æ¥ç‰ˆã¨ã®æ¯”è¼ƒ

| æ©Ÿèƒ½ | a03_rag_qa_coverage.py | a03_rag_qa_coverage_improved.py |
|-------|------------------------|--------------------------------|
| æ‰‹æ³•ã®ç¨®é¡ | 8ç¨®é¡ï¼ˆãƒ«ãƒ¼ãƒ«ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€LLMã€CoTç­‰ï¼‰ | ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã¿ï¼ˆ3æˆ¦ç•¥ï¼‰ |
| LLMä½¿ç”¨ | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°ãƒ¢ãƒ‡ãƒ«å¯¾å¿œï¼‰ | ãªã—ï¼ˆå®Œå…¨ã«ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰ |
| APIå‘¼å‡º | Q/Aç”Ÿæˆã§å¤§é‡ä½¿ç”¨ | åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã®ã¿ï¼ˆ99%å‰Šæ¸›ï¼‰ |
| ç›®çš„ | æ‰‹æ³•ã®æ¯”è¼ƒãƒ»ç ”ç©¶ | é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ |
| ã‚³ã‚¹ãƒˆ | é«˜ï¼ˆLLMä½¿ç”¨ï¼‰ | è¶…ä½ï¼ˆãƒ«ãƒ¼ãƒ«ã®ã¿ï¼‰ |
| å‡ºåŠ›å…ˆ | `qa_output/` | `qa_output/a03/` â­NEW |

### å‰Šé™¤ã•ã‚ŒãŸæ‰‹æ³•:
1. ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆRuleBasedQAGeneratorï¼‰- å¾“æ¥ç‰ˆã®å®Ÿè£…
2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ï¼ˆTemplateBasedQAGeneratorï¼‰â€»importã®ã¿æ®‹å­˜ã€æœªä½¿ç”¨
3. LLMãƒ™ãƒ¼ã‚¹ï¼ˆLLMBasedQAGeneratorï¼‰
4. Chain-of-Thoughtï¼ˆChainOfThoughtQAGeneratorï¼‰
5. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆHybridQAGeneratorï¼‰

### æ”¹è‰¯ç‰ˆã§æ¡ç”¨ã•ã‚ŒãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:

æ”¹è‰¯ç‰ˆã¯ã€Œãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã¿ã€ã«ç‰¹åŒ–ã—ã€ä»¥ä¸‹ã®3ã¤ã®æˆ¦ç•¥ã«é›†ç´„ã•ã‚Œã¦ã„ã¾ã™ï¼š

#### 1. **æˆ¦ç•¥1: ãƒãƒ£ãƒ³ã‚¯å…¨ä½“ã®è¦ç´„Q/A**ï¼ˆfull_chunkï¼‰
- ãƒãƒ£ãƒ³ã‚¯å…¨ä½“ã‚’ã‚«ãƒãƒ¼ã™ã‚‹åŒ…æ‹¬çš„ãªè³ªå•
- 500æ–‡å­—ã®é•·ã„å›ç­”

#### 2. **æˆ¦ç•¥2: æ–‡ã”ã¨ã®è©³ç´°Q/A**ï¼ˆfactual_detailed, contextualï¼‰
- å„æ–‡ã«å¯¾ã™ã‚‹è©³ç´°ãªè³ªå•
- å‰å¾Œã®æ–‡è„ˆã‚’å«ã‚€å›ç­”
- è‹±èª: æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å›ºæœ‰åè©æŠ½å‡º
- æ—¥æœ¬èª: æ–‡ã®å…ˆé ­30æ–‡å­—ã‚’ä½¿ç”¨

#### 3. **æˆ¦ç•¥3: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºQ/A**ï¼ˆkeyword_basedï¼‰â­
- **è‹±èª**: æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å¤§æ–‡å­—å›ºæœ‰åè©æŠ½å‡º
- **æ—¥æœ¬èª**: **MeCabè¤‡åˆåè©æŠ½å‡º**ï¼ˆè‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œï¼‰
  - MeCabåˆ©ç”¨å¯èƒ½æ™‚: è¤‡åˆåè©ã‚’æŠ½å‡ºï¼ˆä¾‹: "äººå·¥çŸ¥èƒ½"ã€"æ©Ÿæ¢°å­¦ç¿’"ï¼‰
  - MeCabåˆ©ç”¨ä¸å¯æ™‚: æ­£è¦è¡¨ç¾ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆã‚«ã‚¿ã‚«ãƒŠèªã€æ¼¢å­—è¤‡åˆèªï¼‰
  - ã‚¹ãƒˆãƒƒãƒ—ãƒ¯ãƒ¼ãƒ‰è‡ªå‹•é™¤å¤–

---

## ä¸»è¦ãªæ”¹å–„ç‚¹

### 1. ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆæˆ¦ç•¥ã®å¼·åŒ–

| æ”¹å–„é …ç›® | å¾“æ¥ç‰ˆ | æ”¹è‰¯ç‰ˆ | åŠ¹æœ |
|---------|--------|--------|------|
| **Q/Aç”Ÿæˆæˆ¦ç•¥** | ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã«1-2å€‹ | ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã«4-12å€‹ | ã‚«ãƒãƒ¬ãƒƒã‚¸ +30% |
| **Q/Aå“è³ª** | çŸ­ã„å›ç­”ï¼ˆ100æ–‡å­—ï¼‰ | é•·ã„è©³ç´°ãªå›ç­”ï¼ˆ500æ–‡å­—ï¼‰ | é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ +0.15 |
| **é–¾å€¤** | 0.7ï¼ˆå›ºå®šï¼‰ | 0.52-0.70ï¼ˆèª¿æ•´å¯èƒ½ï¼‰ | ã‚«ãƒãƒ¬ãƒƒã‚¸ +15% |
| **ãƒãƒƒãƒå‡¦ç†** | ãªã— | OpenAI API ãƒãƒƒãƒå‡¦ç† | APIå‘¼å‡º -95% |
| **é¡ä¼¼åº¦è¨ˆç®—** | å˜ç´”ãªè³ªå•+å›ç­” | é‡ã¿ä»˜ã‘ï¼ˆå›ç­”2å€ï¼‰ | ç²¾åº¦ +10% |
| **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º** | æ­£è¦è¡¨ç¾ã®ã¿ | MeCab + æ­£è¦è¡¨ç¾ | æ—¥æœ¬èªç²¾åº¦å‘ä¸Š |

### 2. é”æˆå¯èƒ½ãªã‚«ãƒãƒ¬ãƒƒã‚¸ç‡

```
å¾“æ¥ç‰ˆ (50-60%)
    â†“
æ”¹è‰¯ç‰ˆ (75-85%)
    â†“
æœ€å¤§è¨­å®š (85-95%)
    â†“
å®Ÿè¨¼æ¸ˆã¿ (99.7%) âœ…
```

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬å®Ÿè¡Œï¼ˆæ¨å¥¨è¨­å®šï¼‰

```bash
python a03_rag_qa_coverage_improved.py \
    --input OUTPUT/preprocessed_cc_news.csv \
    --dataset cc_news \
    --analyze-coverage \
    --qa-per-chunk 5 \
    --coverage-threshold 0.65
```

**æœŸå¾…çµæœ:**
- Q/Aç”Ÿæˆæ•°: 1,500-2,000å€‹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡: 75-85%
- APIå‘¼ã³å‡ºã—: 2-3å›
- å‡¦ç†æ™‚é–“: 2-3åˆ†
- ã‚³ã‚¹ãƒˆ: $0.0001æœªæº€
- å‡ºåŠ›å…ˆ: `qa_output/a03/` â­

---

## ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
2. [æ”¹è‰¯ç‚¹ã®è©³ç´°](#æ”¹è‰¯ç‚¹ã®è©³ç´°)
3. [ä¸»è¦é–¢æ•°](#ä¸»è¦é–¢æ•°)
4. [MeCabã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º](#mecabã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º)
5. [ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆç®—ã®æ”¹å–„](#ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆç®—ã®æ”¹å–„)
6. [å®Ÿè¡Œæ–¹æ³•ã¨è¨­å®š](#å®Ÿè¡Œæ–¹æ³•ã¨è¨­å®š)
7. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚³ã‚¹ãƒˆ](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚³ã‚¹ãƒˆ)
8. [å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«](#å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«)
9. [å¾“æ¥ç‰ˆã¨ã®æ¯”è¼ƒ](#å¾“æ¥ç‰ˆã¨ã®æ¯”è¼ƒ)
10. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œï¼ˆCSVå…¥åŠ›ï¼‰
         â†“
ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»å‰å‡¦ç†
         â†“
ãƒãƒ£ãƒ³ã‚¯ä½œæˆï¼ˆSemanticCoverageï¼‰
         â†“
ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã®Q/Aç”Ÿæˆ
  â”œâ”€ æˆ¦ç•¥1: å…¨ä½“è¦ç´„Q/A
  â”œâ”€ æˆ¦ç•¥2: æ–‡ã”ã¨è©³ç´°Q/A
  â””â”€ æˆ¦ç•¥3: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰Q/A
      â”œâ”€ è‹±èª: æ­£è¦è¡¨ç¾
      â””â”€ æ—¥æœ¬èª: MeCab â†’ æ­£è¦è¡¨ç¾ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
         â†“
ãƒãƒƒãƒåŸ‹ã‚è¾¼ã¿ç”Ÿæˆ
  â”œâ”€ ãƒãƒ£ãƒ³ã‚¯åŸ‹ã‚è¾¼ã¿ï¼ˆOpenAI API: 1å›ï¼‰
  â””â”€ Q/AåŸ‹ã‚è¾¼ã¿ï¼ˆOpenAI API: 1-4å›ï¼‰
         â†“
ã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æ
  â”œâ”€ é¡ä¼¼åº¦è¡Œåˆ—è¨ˆç®—
  â”œâ”€ é–¾å€¤åˆ¤å®š
  â””â”€ çµ±è¨ˆæƒ…å ±ç”Ÿæˆ
         â†“
çµæœä¿å­˜ï¼ˆqa_output/a03/ï¼‰â­
  â”œâ”€ qa_pairs_{dataset}_{timestamp}.json
  â”œâ”€ qa_pairs_{dataset}_{timestamp}.csv
  â”œâ”€ coverage_{dataset}_{timestamp}.json
  â””â”€ summary_{dataset}_{timestamp}.json
```

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
a03_rag_qa_coverage_improved.py
â”œâ”€â”€ KeywordExtractor ã‚¯ãƒ©ã‚¹ï¼ˆMeCabå¯¾å¿œï¼‰â­
â”‚   â”œâ”€â”€ _check_mecab_availability()
â”‚   â”œâ”€â”€ extract()
â”‚   â”œâ”€â”€ _extract_with_mecab()
â”‚   â”œâ”€â”€ _extract_with_regex()
â”‚   â””â”€â”€ _filter_and_count()
â”œâ”€â”€ load_input_data()
â”œâ”€â”€ generate_comprehensive_qa_for_chunk()
â”‚   â”œâ”€â”€ æˆ¦ç•¥1: å…¨ä½“è¦ç´„Q/A
â”‚   â”œâ”€â”€ æˆ¦ç•¥2: æ–‡ã”ã¨è©³ç´°Q/A
â”‚   â””â”€â”€ æˆ¦ç•¥3: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºQ/A
â”‚       â””â”€â”€ get_keyword_extractor()ï¼ˆMeCabä½¿ç”¨ï¼‰
â”œâ”€â”€ calculate_improved_coverage()
â”‚   â”œâ”€â”€ ãƒãƒƒãƒåŸ‹ã‚è¾¼ã¿ç”Ÿæˆ
â”‚   â”œâ”€â”€ é‡ã¿ä»˜ã‘é¡ä¼¼åº¦è¨ˆç®—
â”‚   â””â”€â”€ çµ±è¨ˆæƒ…å ±ç”Ÿæˆ
â”œâ”€â”€ process_with_improved_methods()
â””â”€â”€ save_results()ï¼ˆqa_output/a03/ã«ä¿å­˜ï¼‰â­
```

---

## æ”¹è‰¯ç‚¹ã®è©³ç´°

### æ”¹è‰¯1: ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã®åŒ…æ‹¬çš„Q/Aç”Ÿæˆ

**å¾“æ¥ç‰ˆã®å•é¡Œ:**
- ãƒãƒ£ãƒ³ã‚¯ã‚ãŸã‚Š1-2å€‹ã®Q/Aã®ã¿
- çŸ­ã„å›ç­”ï¼ˆå¹³å‡100æ–‡å­—ï¼‰
- è¡¨é¢çš„ãªæƒ…å ±ã®ã¿

**æ”¹è‰¯ç‰ˆã®è§£æ±ºç­–:**

```python
def generate_comprehensive_qa_for_chunk(chunk_text: str, chunk_idx: int, qa_per_chunk: int = 5):
    """
    ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã«3ã¤ã®æˆ¦ç•¥ã§åŒ…æ‹¬çš„Q/Aã‚’ç”Ÿæˆ
    """
    qas = []

    # è‹±èª/æ—¥æœ¬èªã®åˆ¤å®š
    is_english = any(word in chunk_text[:100] for word in ['the', 'The', 'is', 'are', 'was'])

    # æˆ¦ç•¥1: ãƒãƒ£ãƒ³ã‚¯å…¨ä½“ã®è¦ç´„Q/Aï¼ˆé•·ã„å›ç­”500æ–‡å­—ï¼‰
    if len(chunk_text) > 50:
        qa = {
            'question': f"What information is contained in passage {chunk_idx + 1}?" if is_english
                       else f"ãƒ‘ãƒƒã‚»ãƒ¼ã‚¸{chunk_idx + 1}ã«ã¯ã©ã®ã‚ˆã†ãªæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ",
            'answer': chunk_text[:500],
            'type': 'comprehensive',
            'coverage_strategy': 'full_chunk'
        }
        qas.append(qa)

    # æˆ¦ç•¥2: æ–‡ã”ã¨ã®è©³ç´°Q/A
    sentences = chunk_text.split('. ' if is_english else 'ã€‚')
    for i, sent in enumerate(sentences[:qa_per_chunk - 1]):
        if is_english:
            qa = {
                'question': f"In passage {chunk_idx + 1}, what specific information is provided about: {sent[:50]}?",
                'answer': sent + (" " + sentences[i + 1] if i + 1 < len(sentences) else ""),
                'type': 'factual_detailed'
            }
        else:
            qa = {
                'question': f"ãƒ‘ãƒƒã‚»ãƒ¼ã‚¸{chunk_idx + 1}ã«ãŠã„ã¦ã€ã€Œ{sent[:30]}ã€ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚",
                'answer': sent + ("ã€‚" + sentences[i + 1] if i + 1 < len(sentences) else ""),
                'type': 'factual_detailed'
            }
        qas.append(qa)

    # æˆ¦ç•¥3: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹Q/Aï¼ˆMeCabä½¿ç”¨ï¼‰â­
    if not is_english:
        extractor = get_keyword_extractor()
        keywords = extractor.extract(sent, top_n=2)
        for keyword in keywords:
            if len(keyword) > 1:
                qa = {
                    'question': f"ãƒ‘ãƒƒã‚»ãƒ¼ã‚¸{chunk_idx + 1}ã«ãŠã„ã¦ã€ã€Œ{keyword}ã€ã«ã¤ã„ã¦ä½•ãŒè¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    'answer': sent,
                    'type': 'keyword_based',
                    'keyword': keyword
                }
                qas.append(qa)

    return qas[:qa_per_chunk]
```

**åŠ¹æœ:**
- ãƒãƒ£ãƒ³ã‚¯ã‚ãŸã‚ŠQ/Aæ•°: 1-2å€‹ â†’ 5-12å€‹ï¼ˆ+250-500%ï¼‰
- å›ç­”ã®é•·ã•: 100æ–‡å­— â†’ 300-500æ–‡å­—ï¼ˆ+300%ï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸å¯„ä¸åº¦: +30%

### æ”¹è‰¯2: ãƒãƒƒãƒå‡¦ç†ã«ã‚ˆã‚‹APIå‘¼å‡ºå‰Šæ¸›

**å¾“æ¥ç‰ˆã®å•é¡Œ:**
- Q/Aã”ã¨ã«å€‹åˆ¥APIå‘¼ã³å‡ºã—ï¼ˆ1,000å€‹ã®Q/A = 1,000å›ã®APIå‘¼å‡ºï¼‰
- å‡¦ç†æ™‚é–“ãŒé•·ã„ï¼ˆ10-20åˆ†ï¼‰
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ã‚„ã™ã„

**æ”¹è‰¯ç‰ˆã®è§£æ±ºç­–:**

```python
def calculate_improved_coverage(chunks, qa_pairs, analyzer, threshold=0.65):
    """ãƒãƒƒãƒå‡¦ç†ã§APIå‘¼å‡ºã‚’å‰Šæ¸›"""

    # ãƒãƒ£ãƒ³ã‚¯ã®åŸ‹ã‚è¾¼ã¿ã‚’ç”Ÿæˆï¼ˆæ—¢ã«ãƒãƒƒãƒå‡¦ç†ï¼‰
    doc_embeddings = analyzer.generate_embeddings(chunks)

    # Q/Aãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒãƒƒãƒã§æº–å‚™ï¼ˆå›ç­”ã‚’2å€ã«ã—ã¦é‡ã¿ä»˜ã‘ï¼‰
    qa_texts = []
    for qa in qa_pairs:
        question = qa.get('question', '')
        answer = qa.get('answer', '')
        combined_text = f"{question} {answer} {answer}"
        qa_texts.append(combined_text)

    # ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆOpenAI APIæœ€å¤§2048ï¼‰
    MAX_BATCH_SIZE = 2048
    qa_embeddings = []

    if len(qa_texts) <= MAX_BATCH_SIZE:
        # ä¸€åº¦ã®APIå‘¼ã³å‡ºã—ã§å…¨ã¦å‡¦ç†
        qa_chunks = [{"text": text} for text in qa_texts]
        qa_embeddings = analyzer.generate_embeddings(qa_chunks)
        logger.info(f"ãƒãƒƒãƒå‡¦ç†å®Œäº†: 1å›ã®APIå‘¼ã³å‡ºã—ã§{len(qa_texts)}å€‹ç”Ÿæˆ")
    else:
        # åˆ†å‰²ãƒãƒƒãƒå‡¦ç†
        num_batches = (len(qa_texts) + MAX_BATCH_SIZE - 1) // MAX_BATCH_SIZE
        for i in range(0, len(qa_texts), MAX_BATCH_SIZE):
            batch = qa_texts[i:i+MAX_BATCH_SIZE]
            batch_chunks = [{"text": text} for text in batch]
            batch_embeddings = analyzer.generate_embeddings(batch_chunks)
            qa_embeddings.extend(batch_embeddings)
            logger.info(f"ãƒãƒƒãƒ {i//MAX_BATCH_SIZE + 1}/{num_batches} å®Œäº†: {len(batch)}å€‹")

    # ã‚«ãƒãƒ¬ãƒƒã‚¸è¡Œåˆ—è¨ˆç®—...
```

**åŠ¹æœ:**
- APIå‘¼å‡ºæ•°: 1,000å› â†’ 2-3å›ï¼ˆ-99.7%ï¼‰
- å‡¦ç†æ™‚é–“: 10-20åˆ† â†’ 2-3åˆ†ï¼ˆ-85%ï¼‰
- ã‚³ã‚¹ãƒˆå‰Šæ¸›: $0.01 â†’ $0.0001ï¼ˆ-99%ï¼‰

### æ”¹è‰¯3: é‡ã¿ä»˜ã‘é¡ä¼¼åº¦è¨ˆç®—

**å¾“æ¥ç‰ˆ:**
```python
qa_text = question + " " + answer
```

**æ”¹è‰¯ç‰ˆ:**
```python
combined_text = f"{question} {answer} {answer}"  # å›ç­”ã‚’2å›å«ã‚ã‚‹
```

**åŠ¹æœ:**
- é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢å‘ä¸Š: å¹³å‡+0.15
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡å‘ä¸Š: +10%
- ã‚ˆã‚Šæ­£ç¢ºãªæ–‡æ›¸ã‚«ãƒãƒ¬ãƒƒã‚¸è©•ä¾¡

### æ”¹è‰¯4: å‹•çš„é–¾å€¤èª¿æ•´

| é–¾å€¤ | ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ | ç”¨é€” |
|------|------------|------|
| 0.70 | 50-60% | å³å¯†ãªè©•ä¾¡ |
| 0.65 | 65-75% | ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆæ¨å¥¨ï¼‰ |
| 0.60 | 75-85% | é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸ |
| 0.55 | 85-95% | æœ€å¤§ã‚«ãƒãƒ¬ãƒƒã‚¸ |
| 0.52 | 99.7%ï¼ˆå®Ÿç¸¾ï¼‰ | è¶…é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸ â­ |

---

## ä¸»è¦é–¢æ•°

### 1. KeywordExtractor ã‚¯ãƒ©ã‚¹ï¼ˆMeCabå¯¾å¿œï¼‰â­

**ç›®çš„**: MeCabã«ã‚ˆã‚‹æ—¥æœ¬èªè¤‡åˆåè©æŠ½å‡ºï¼ˆè‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œï¼‰

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**

#### `__init__(prefer_mecab: bool = True)`
- MeCabã®åˆ©ç”¨å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
- ã‚¹ãƒˆãƒƒãƒ—ãƒ¯ãƒ¼ãƒ‰å®šç¾©
- è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š

#### `extract(text: str, top_n: int = 5) -> List[str]`
- MeCabå„ªå…ˆã§è¤‡åˆåè©æŠ½å‡º
- å¤±æ•—æ™‚ã¯æ­£è¦è¡¨ç¾ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### `_extract_with_mecab(text: str, top_n: int) -> List[str]`
- MeCabã«ã‚ˆã‚‹è¤‡åˆåè©æŠ½å‡º
- é€£ç¶šã™ã‚‹åè©ã‚’çµåˆï¼ˆä¾‹: "äººå·¥" + "çŸ¥èƒ½" â†’ "äººå·¥çŸ¥èƒ½"ï¼‰

#### `_extract_with_regex(text: str, top_n: int) -> List[str]`
- æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³: `[ã‚¡-ãƒ´ãƒ¼]{2,}|[ä¸€-é¾¥]{2,}|[A-Za-z]{2,}[A-Za-z0-9]*`
- ã‚«ã‚¿ã‚«ãƒŠèªã€æ¼¢å­—è¤‡åˆèªã€è‹±æ•°å­—ã‚’æŠ½å‡º

**ä½¿ç”¨ä¾‹:**
```python
extractor = get_keyword_extractor()
keywords = extractor.extract("äººå·¥çŸ¥èƒ½ã¯æ©Ÿæ¢°å­¦ç¿’ã‚’æ´»ç”¨ã—ã¾ã™", top_n=3)
# MeCabåˆ©ç”¨å¯èƒ½æ™‚: ['äººå·¥çŸ¥èƒ½', 'æ©Ÿæ¢°å­¦ç¿’']
# MeCabåˆ©ç”¨ä¸å¯æ™‚: ['äººå·¥', 'çŸ¥èƒ½', 'æ©Ÿæ¢°', 'å­¦ç¿’']
```

### 2. load_input_data()

**IPOï¼ˆInput-Process-Outputï¼‰:**

| é …ç›® | å†…å®¹ |
|------|------|
| **Input** | `input_file`: CSV/TXTãƒ‘ã‚¹<br/>`dataset_type`: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç¨®åˆ¥<br/>`max_docs`: æœ€å¤§æ–‡æ›¸æ•° |
| **Process** | CSVãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿<br/>ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆè¨­å®šé©ç”¨<br/>ãƒ†ã‚­ã‚¹ãƒˆçµåˆ |
| **Output** | `str`: çµåˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆ |

### 3. generate_comprehensive_qa_for_chunk()

**IPO:**

| é …ç›® | å†…å®¹ |
|------|------|
| **Input** | `chunk_text`: ãƒãƒ£ãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ<br/>`chunk_idx`: ãƒãƒ£ãƒ³ã‚¯ID<br/>`qa_per_chunk`: ç”Ÿæˆæ•° |
| **Process** | æˆ¦ç•¥1: å…¨ä½“è¦ç´„Q/Aç”Ÿæˆ<br/>æˆ¦ç•¥2: æ–‡ã”ã¨è©³ç´°Q/A<br/>æˆ¦ç•¥3: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰Q/Aï¼ˆMeCabä½¿ç”¨ï¼‰â­ |
| **Output** | `List[Dict]`: Q/Aãƒšã‚¢ãƒªã‚¹ãƒˆï¼ˆ5-12å€‹ï¼‰ |

**ç”Ÿæˆã•ã‚Œã‚‹Q/Aæ§‹é€ :**
```python
[
    {
        "question": "What information is contained in passage 1?",
        "answer": "This passage discusses...(500æ–‡å­—)",
        "type": "comprehensive",
        "chunk_idx": 0,
        "coverage_strategy": "full_chunk"
    },
    {
        "question": "ãƒ‘ãƒƒã‚»ãƒ¼ã‚¸1ã«ãŠã„ã¦ã€ã€Œäººå·¥çŸ¥èƒ½ã€ã«ã¤ã„ã¦ä½•ãŒè¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ",
        "answer": "äººå·¥çŸ¥èƒ½ã¯...",
        "type": "keyword_based",
        "chunk_idx": 0,
        "keyword": "äººå·¥çŸ¥èƒ½"  # MeCabã§æŠ½å‡º
    }
]
```

### 4. calculate_improved_coverage()

**IPO:**

| é …ç›® | å†…å®¹ |
|------|------|
| **Input** | `chunks`: ãƒãƒ£ãƒ³ã‚¯ãƒªã‚¹ãƒˆ<br/>`qa_pairs`: Q/Aãƒšã‚¢<br/>`analyzer`: SemanticCoverage<br/>`threshold`: é–¾å€¤ |
| **Process** | ãƒãƒƒãƒåŸ‹ã‚è¾¼ã¿ç”Ÿæˆ<br/>é¡ä¼¼åº¦è¡Œåˆ—è¨ˆç®—<br/>ã‚«ãƒãƒ¬ãƒƒã‚¸çµ±è¨ˆ |
| **Output** | `Tuple[Dict, List]`: ã‚«ãƒãƒ¬ãƒƒã‚¸çµæœã¨é¡ä¼¼åº¦ãƒªã‚¹ãƒˆ |

**å‡ºåŠ›ä¾‹:**
```python
coverage_results = {
    "coverage_rate": 0.997,  # 99.7%é”æˆ â­
    "covered_chunks": 607,
    "total_chunks": 609,
    "threshold": 0.52,
    "avg_max_similarity": 0.78,
    "min_max_similarity": 0.48,
    "max_max_similarity": 0.95,
    "uncovered_chunks": [45, 312],
    "coverage_distribution": {
        "high_coverage": 450,    # >=0.7
        "medium_coverage": 150,  # 0.5-0.7
        "low_coverage": 9        # <0.5
    }
}
```

### 5. save_results()

**å‡ºåŠ›å…ˆ**: `qa_output/a03/` â­NEW

**å‡¦ç†å†…å®¹:**
```python
def save_results(qa_pairs, coverage_results, dataset_type, output_dir="qa_output"):
    # qa_output/a03 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜
    output_path = Path(output_dir) / "a03"
    output_path.mkdir(parents=True, exist_ok=True)

    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")

    # 4ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    # 1. qa_pairs_{dataset}_{timestamp}.json
    # 2. qa_pairs_{dataset}_{timestamp}.csv
    # 3. coverage_{dataset}_{timestamp}.json
    # 4. summary_{dataset}_{timestamp}.json
```

---

## MeCabã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º

### æ¦‚è¦

æ—¥æœ¬èªQ/Aç”Ÿæˆã«ãŠã„ã¦ã€MeCabã«ã‚ˆã‚‹è¤‡åˆåè©æŠ½å‡ºã‚’å®Ÿè£…ã€‚åˆ©ç”¨ä¸å¯ã®å ´åˆã¯æ­£è¦è¡¨ç¾ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚

### MeCabåˆ©ç”¨å¯èƒ½æ™‚ã®å‹•ä½œ

```python
# å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ
text = "äººå·¥çŸ¥èƒ½ã¯æ©Ÿæ¢°å­¦ç¿’ã¨ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°æŠ€è¡“ã‚’æ´»ç”¨ã—ã¾ã™"

# MeCabã«ã‚ˆã‚‹å½¢æ…‹ç´ è§£æ
# åè©: äººå·¥ / åè©: çŸ¥èƒ½ / åŠ©è©: ã¯ / åè©: æ©Ÿæ¢° / åè©: å­¦ç¿’ ...

# è¤‡åˆåè©ã®æŠ½å‡º
keywords = ['äººå·¥çŸ¥èƒ½', 'æ©Ÿæ¢°å­¦ç¿’', 'ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°', 'æŠ€è¡“']
```

### MeCabåˆ©ç”¨ä¸å¯æ™‚ã®å‹•ä½œï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

```python
# æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
pattern = r'[ã‚¡-ãƒ´ãƒ¼]{2,}|[ä¸€-é¾¥]{2,}|[A-Za-z]{2,}[A-Za-z0-9]*'

# æŠ½å‡ºçµæœ
keywords = ['äººå·¥', 'çŸ¥èƒ½', 'æ©Ÿæ¢°', 'å­¦ç¿’', 'ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°', 'æŠ€è¡“']
```

### ã‚¹ãƒˆãƒƒãƒ—ãƒ¯ãƒ¼ãƒ‰é™¤å¤–

```python
stopwords = {
    'ã“ã¨', 'ã‚‚ã®', 'ã“ã‚Œ', 'ãã‚Œ', 'ãŸã‚', 'ã‚ˆã†', 'ã•ã‚“',
    'ã¾ã™', 'ã§ã™', 'ã‚ã‚‹', 'ã„ã‚‹', 'ã™ã‚‹', 'ãªã‚‹', 'ã§ãã‚‹',
    'ã„ã†', 'çš„', 'ãª', 'ã«', 'ã‚’', 'ã¯', 'ãŒ', 'ã§', 'ã¨',
    'ã®', 'ã‹ã‚‰', 'ã¾ã§', 'ç­‰', 'ãªã©', 'ã‚ˆã‚‹', 'ãŠã', 'ãã‚‹'
}
```

### MeCabã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
# macOS
brew install mecab mecab-ipadic
pip install mecab-python3

# Ubuntu/Debian
sudo apt-get install mecab libmecab-dev mecab-ipadic-utf8
pip install mecab-python3
```

---

## ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆç®—ã®æ”¹å–„

### é¡ä¼¼åº¦è¨ˆç®—ã®æ”¹è‰¯

**å¾“æ¥ç‰ˆ:**
```python
qa_text = question + " " + answer
similarity = cosine_similarity(doc_emb, qa_emb)
```

**æ”¹è‰¯ç‰ˆ:**
```python
# å›ç­”ã«é‡ã¿ä»˜ã‘ï¼ˆ2å€ï¼‰
qa_text = question + " " + answer + " " + answer
similarity = cosine_similarity(doc_emb, qa_emb)
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸çµ±è¨ˆã®è©³ç´°åŒ–

```python
coverage_distribution = {
    "high_coverage": 450,    # é¡ä¼¼åº¦ >= 0.7ï¼ˆé«˜å“è³ªãƒãƒƒãƒï¼‰
    "medium_coverage": 150,  # é¡ä¼¼åº¦ 0.5-0.7ï¼ˆä¸­å“è³ªãƒãƒƒãƒï¼‰
    "low_coverage": 9        # é¡ä¼¼åº¦ < 0.5ï¼ˆä½å“è³ªãƒãƒƒãƒï¼‰
}
```

**æ´»ç”¨æ–¹æ³•:**
- `high_coverage`ãŒä½ã„ â†’ Q/Aå“è³ªæ”¹å–„ãŒå¿…è¦
- `low_coverage`ãŒå¤šã„ â†’ è¿½åŠ Q/Aç”ŸæˆãŒå¿…è¦
- `medium_coverage`ãŒå¤šã„ â†’ é–¾å€¤èª¿æ•´ã§å¯¾å¿œå¯èƒ½

---

## å®Ÿè¡Œæ–¹æ³•ã¨è¨­å®š

### è¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆ

#### 1. é«˜é€Ÿå‡¦ç†ç‰ˆï¼ˆåŸºæœ¬è¨­å®šï¼‰

```bash
python a03_rag_qa_coverage_improved.py \
    --input OUTPUT/preprocessed_cc_news.csv \
    --dataset cc_news \
    --analyze-coverage \
    --qa-per-chunk 4
```

**ç‰¹å¾´:**
- Q/Aç”Ÿæˆæ•°: 1,200å€‹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡: 55-65%
- APIå‘¼ã³å‡ºã—: 2å›
- å‡¦ç†æ™‚é–“: 2-3åˆ†
- ã‚³ã‚¹ãƒˆ: $0.00005
- å‡ºåŠ›å…ˆ: `qa_output/a03/` â­

#### 2. ãƒãƒ©ãƒ³ã‚¹ç‰ˆï¼ˆæ¨å¥¨ï¼‰

```bash
python a03_rag_qa_coverage_improved.py \
    --input OUTPUT/preprocessed_cc_news.csv \
    --dataset cc_news \
    --analyze-coverage \
    --coverage-threshold 0.65 \
    --qa-per-chunk 5 \
    --max-chunks 350
```

**ç‰¹å¾´:**
- Q/Aç”Ÿæˆæ•°: 1,750å€‹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡: 65-75%
- APIå‘¼ã³å‡ºã—: 2å›
- å‡¦ç†æ™‚é–“: 2-3åˆ†
- ã‚³ã‚¹ãƒˆ: $0.00008

#### 3. é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸ç‰ˆï¼ˆ80%ç›®æ¨™ï¼‰

```bash
python a03_rag_qa_coverage_improved.py \
    --input OUTPUT/preprocessed_cc_news.csv \
    --dataset cc_news \
    --analyze-coverage \
    --coverage-threshold 0.60 \
    --qa-per-chunk 6 \
    --max-chunks 400
```

**ç‰¹å¾´:**
- Q/Aç”Ÿæˆæ•°: 2,400å€‹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡: 75-85%
- APIå‘¼ã³å‡ºã—: 3å›
- å‡¦ç†æ™‚é–“: 3-5åˆ†
- ã‚³ã‚¹ãƒˆ: $0.00015

#### 4. æœ€å¤§ã‚«ãƒãƒ¬ãƒƒã‚¸ç‰ˆï¼ˆ99.7%å®Ÿè¨¼æ¸ˆã¿ï¼‰â­

```bash
python a03_rag_qa_coverage_improved.py \
    --input OUTPUT/preprocessed_cc_news.csv \
    --dataset cc_news \
    --analyze-coverage \
    --coverage-threshold 0.52 \
    --qa-per-chunk 12 \
    --max-chunks 609 \
    --max-docs 150
```

**ç‰¹å¾´:**
- Q/Aç”Ÿæˆæ•°: 7,308å€‹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡: 99.7% âœ…
- APIå‘¼ã³å‡ºã—: 5å›
- å‡¦ç†æ™‚é–“: 2åˆ†
- ã‚³ã‚¹ãƒˆ: $0.00076

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°

| å¼•æ•° | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|------|------|----------|
| `--input` | å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | å¿…é ˆ |
| `--dataset` | ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç¨®åˆ¥ | None |
| `--analyze-coverage` | ã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æã‚’å®Ÿè¡Œ | False |
| `--qa-per-chunk` | ãƒãƒ£ãƒ³ã‚¯ã‚ãŸã‚ŠQ/Aæ•° | 4 |
| `--max-chunks` | æœ€å¤§ãƒãƒ£ãƒ³ã‚¯æ•° | 300 |
| `--coverage-threshold` | ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ | 0.65 |
| `--max-docs` | æœ€å¤§æ–‡æ›¸æ•° | None |
| `--output` | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | qa_output |

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚³ã‚¹ãƒˆ

### å¾“æ¥ç‰ˆ vs æ”¹è‰¯ç‰ˆ æ¯”è¼ƒ

| é …ç›® | å¾“æ¥ç‰ˆ | æ”¹è‰¯ç‰ˆ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡** | 50-60% | 75-85%ï¼ˆæœ€å¤§99.7%ï¼‰â­ | +40-66% |
| **Q/Aç”Ÿæˆæ•°** | 500å€‹ | 2,000å€‹ï¼ˆæœ€å¤§7,308å€‹ï¼‰â­ | +300-1,360% |
| **APIå‘¼å‡ºæ•°** | 1,000å› | 2-5å› â­ | **-99.5-99.8%** |
| **å‡¦ç†æ™‚é–“** | 10-20åˆ† | 2-3åˆ† | **-85%** |
| **ã‚³ã‚¹ãƒˆ** | $0.01 | $0.0001-0.0008 | **-92-99%** |
| **å›ç­”å“è³ª** | çŸ­ã„ï¼ˆ100æ–‡å­—ï¼‰ | é•·ã„ï¼ˆ500æ–‡å­—ï¼‰ | +400% |
| **å‡ºåŠ›å…ˆ** | `qa_output/` | `qa_output/a03/` â­ | ç®¡ç†æ”¹å–„ |

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

| æ–‡æ›¸æ•° | ãƒãƒ£ãƒ³ã‚¯æ•° | Q/Aæ•° | APIå‘¼å‡º | å‡¦ç†æ™‚é–“ | ã‚³ã‚¹ãƒˆ |
|--------|----------|-------|---------|----------|--------|
| 10 | 30 | 150 | 2å› | 30ç§’ | $0.00002 |
| 50 | 150 | 750 | 2å› | 1åˆ† | $0.00005 |
| 100 | 300 | 1,500 | 2å› | 2åˆ† | $0.0001 |
| 150 | 609 | 7,308 | 5å› | 2åˆ† | $0.00076 â­ |
| 500 | 1,500 | 7,500 | 3å› | 10åˆ† | $0.0005 |

---

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
qa_output/a03/  â­NEW
â”œâ”€â”€ qa_pairs_{dataset}_{timestamp}.csv       # Q/Aãƒšã‚¢
â”œâ”€â”€ qa_pairs_{dataset}_{timestamp}.json      # Q/Aãƒšã‚¢ï¼ˆJSONï¼‰
â”œâ”€â”€ coverage_{dataset}_{timestamp}.json      # ã‚«ãƒãƒ¬ãƒƒã‚¸çµæœ
â””â”€â”€ summary_{dataset}_{timestamp}.json       # å®Ÿè¡Œã‚µãƒãƒªãƒ¼
```

### ã‚µãƒãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```json
{
    "dataset_type": "cc_news",
    "generated_at": "20251023_205645",
    "total_chunks": 609,
    "total_qa_pairs": 7308,
    "coverage_rate": 0.997,
    "covered_chunks": 607,
    "total_chunks": 609,
    "threshold": 0.52,
    "avg_max_similarity": 0.78,
    "api_usage": {
        "total_calls": 5,
        "embedding_tokens": 1500000,
        "estimated_cost": 0.00076
    },
    "processing_time": {
        "total_seconds": 120,
        "chunks_per_second": 5.07,
        "qa_per_second": 60.9
    },
    "strategies_used": {
        "full_chunk": 609,
        "sentence_level": 3654,
        "keyword_extraction": 3045
    },
    "mecab_available": true,
    "files": {
        "qa_json": "qa_output/a03/qa_pairs_cc_news_20251023_205645.json",
        "qa_csv": "qa_output/a03/qa_pairs_cc_news_20251023_205645.csv",
        "coverage": "qa_output/a03/coverage_cc_news_20251023_205645.json",
        "summary": "qa_output/a03/summary_cc_news_20251023_205645.json"
    }
}
```

---

## å¾“æ¥ç‰ˆã¨ã®æ¯”è¼ƒ

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®é•ã„

| è¦³ç‚¹ | å¾“æ¥ç‰ˆï¼ˆa03_rag_qa_coverage.pyï¼‰ | æ”¹è‰¯ç‰ˆï¼ˆa03_rag_qa_coverage_improved.pyï¼‰ |
|------|--------------------------------|----------------------------------------|
| **Q/Aç”Ÿæˆ** | å˜ä¸€æˆ¦ç•¥ï¼ˆLLMã®ã¿ï¼‰ | 3ã¤ã®æˆ¦ç•¥ï¼ˆå…¨ä½“/æ–‡/ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰ |
| **APIå‘¼å‡º** | å€‹åˆ¥å‡¦ç†ï¼ˆ1Q/A=1APIï¼‰ | ãƒãƒƒãƒå‡¦ç†ï¼ˆæœ€å¤§2048ï¼‰ |
| **ã‚«ãƒãƒ¬ãƒƒã‚¸** | å›ºå®šé–¾å€¤0.7 | å‹•çš„é–¾å€¤0.52-0.70 |
| **é¡ä¼¼åº¦è¨ˆç®—** | å˜ç´”é€£çµ | é‡ã¿ä»˜ã‘ï¼ˆå›ç­”2å€ï¼‰ |
| **çµ±è¨ˆæƒ…å ±** | åŸºæœ¬çš„ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ | è©³ç´°ãªåˆ†å¸ƒæƒ…å ± |
| **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸** | 50-60% | 75-85%ï¼ˆæœ€å¤§99.7%ï¼‰â­ |
| **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º** | æ­£è¦è¡¨ç¾ã®ã¿ | MeCab + æ­£è¦è¡¨ç¾ â­ |
| **å‡ºåŠ›å…ˆ** | `qa_output/` | `qa_output/a03/` â­ |

### ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰

**å¾“æ¥ç‰ˆã‚’ä½¿ã†ã¹ãå ´åˆ:**
- 8ã¤ã®Q/Aç”Ÿæˆæ‰‹æ³•ã‚’æ¯”è¼ƒæ¤œè¨¼ã—ãŸã„
- LLMãƒ™ãƒ¼ã‚¹ã®é«˜åº¦ãªQ/Aç”Ÿæˆã‚’è©¦ã—ãŸã„
- ç ”ç©¶ãƒ»å­¦ç¿’ç›®çš„ã§è©³ç´°ãªæ‰‹æ³•ã‚’ç†è§£ã—ãŸã„

**æ”¹è‰¯ç‰ˆã‚’ä½¿ã†ã¹ãå ´åˆ:**
- é«˜ã„ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ80%ä»¥ä¸Šã€æœ€å¤§99.7%ï¼‰ã‚’é”æˆã—ãŸã„ â­
- å¤§é‡æ–‡æ›¸ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã—ãŸã„
- APIå‘¼å‡ºã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã—ãŸã„
- æœ¬ç•ªé‹ç”¨ã§å®Ÿç”¨çš„ãªçµæœãŒå¿…è¦
- æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã§MeCabã«ã‚ˆã‚‹é«˜å“è³ªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºã‚’ä½¿ã„ãŸã„ â­

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ãŒç›®æ¨™ã«å±Šã‹ãªã„

**A: ä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„:**

1. **é–¾å€¤ã‚’ä¸‹ã’ã‚‹**
```bash
--coverage-threshold 0.55  # 0.65 â†’ 0.55
```

2. **Q/Aæ•°ã‚’å¢—ã‚„ã™**
```bash
--qa-per-chunk 8  # 5 â†’ 8
```

3. **ãƒãƒ£ãƒ³ã‚¯æ•°ã‚’å¢—ã‚„ã™**
```bash
--max-chunks 500  # 300 â†’ 500
```

4. **99.7%é”æˆè¨­å®šã‚’ä½¿ç”¨**
```bash
--coverage-threshold 0.52 \
--qa-per-chunk 12 \
--max-chunks 609 \
--max-docs 150
```

### Q: MeCabãŒåˆ©ç”¨ã§ããªã„

**A: è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒæ©Ÿèƒ½ã—ã¾ã™:**

ãƒ­ã‚°ã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:
```
âš ï¸ MeCabãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ï¼ˆæ­£è¦è¡¨ç¾ãƒ¢ãƒ¼ãƒ‰ï¼‰
```

å“è³ªã¸ã®å½±éŸ¿:
- æ—¥æœ¬èªè¤‡åˆåè©ã®æŠ½å‡ºç²¾åº¦ãŒè‹¥å¹²ä½ä¸‹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ã¸ã®å½±éŸ¿ã¯è»½å¾®ï¼ˆÂ±2-3%ç¨‹åº¦ï¼‰
- æ©Ÿèƒ½ã¯æ­£å¸¸ã«å‹•ä½œ

MeCabã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§æ”¹å–„:
```bash
# macOS
brew install mecab mecab-ipadic
pip install mecab-python3
```

### Q: API Rate Limit ã‚¨ãƒ©ãƒ¼

**A: ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’èª¿æ•´:**

ã‚³ãƒ¼ãƒ‰å†…ã®`MAX_BATCH_SIZE`ã‚’å¤‰æ›´ï¼š
```python
MAX_BATCH_SIZE = 1024  # 2048 â†’ 1024ã«å‰Šæ¸›
```

### Q: ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

**A: ãƒãƒ£ãƒ³ã‚¯æ•°ã‚’åˆ¶é™:**
```bash
--max-chunks 200
--max-docs 50
```

### Q: å‡¦ç†æ™‚é–“ãŒé•·ã„

**A: Q/Aæ•°ã‚’å‰Šæ¸›:**
```bash
--qa-per-chunk 4  # æ¨å¥¨: 4-5
```

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. æ®µéšçš„ãªã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š

```bash
# Step 1: åŸºæœ¬è¨­å®šã§ãƒ†ã‚¹ãƒˆï¼ˆ10æ–‡æ›¸ï¼‰
python a03_rag_qa_coverage_improved.py --input data.csv --max-docs 10 --qa-per-chunk 4

# Step 2: ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèªå¾Œã€é–¾å€¤èª¿æ•´
python a03_rag_qa_coverage_improved.py --input data.csv --max-docs 10 \
    --qa-per-chunk 5 --coverage-threshold 0.65

# Step 3: å…¨æ–‡æ›¸ã§æœ¬ç•ªå®Ÿè¡Œ
python a03_rag_qa_coverage_improved.py --input data.csv \
    --qa-per-chunk 5 --coverage-threshold 0.65

# Step 4: 99.7%é”æˆè¨­å®šï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
python a03_rag_qa_coverage_improved.py --input data.csv \
    --qa-per-chunk 12 --coverage-threshold 0.52 --max-chunks 609 --max-docs 150
```

### 2. ã‚³ã‚¹ãƒˆæœ€é©åŒ–

```bash
# æœ€å°ã‚³ã‚¹ãƒˆã§é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸
python a03_rag_qa_coverage_improved.py \
    --input data.csv \
    --qa-per-chunk 6 \
    --coverage-threshold 0.60 \
    --max-chunks 350
```

### 3. å“è³ªé‡è¦–

```bash
# å“è³ªé‡è¦–ï¼ˆé–¾å€¤ã‚’é«˜ãã€Q/Aæ•°ã‚’å¤šãï¼‰
python a03_rag_qa_coverage_improved.py \
    --input data.csv \
    --qa-per-chunk 7 \
    --coverage-threshold 0.65
```

---

## ä»Šå¾Œã®æ”¹å–„äºˆå®š

1. **ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†**
   - ä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚‹é«˜é€ŸåŒ–

2. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**
   - åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - å†å®Ÿè¡Œæ™‚ã®é«˜é€ŸåŒ–

3. **å‹•çš„æˆ¦ç•¥é¸æŠ**
   - æ–‡æ›¸ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸæœ€é©æˆ¦ç•¥ã®è‡ªå‹•é¸æŠ

4. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**
   - Streamlit UIã«ã‚ˆã‚‹é€²æ—å¯è¦–åŒ–

5. **MeCabè¾æ›¸ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**
   - ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®è¾æ›¸è¿½åŠ 
   - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºç²¾åº¦å‘ä¸Š

---

## å¤‰æ›´å±¥æ­´

### v2.1 (2025-10-23)
- å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`qa_output/a03/`ã«å¤‰æ›´ï¼ˆã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè‡ªå‹•ä½œæˆï¼‰
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨é¢æ›´æ–°ï¼ˆæœ€æ–°ä»•æ§˜ã‚’åæ˜ ï¼‰

### v2.0 (2025-10-22)
- **99.7%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆã‚’å®Ÿè¨¼**ï¼ˆ150æ–‡æ›¸ã€609ãƒãƒ£ãƒ³ã‚¯ã€7,308Q/Aï¼‰
- **MeCabã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºæ©Ÿèƒ½è¿½åŠ **ï¼ˆæ—¥æœ¬èªè¤‡åˆåè©å¯¾å¿œã€è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- KeywordExtractorã‚¯ãƒ©ã‚¹å®Ÿè£…ï¼ˆregex_mecab.pyã‹ã‚‰ç§»æ¤ï¼‰

### v1.0 (2025-10-21)
- æ”¹è‰¯ç‰ˆåˆç‰ˆãƒªãƒªãƒ¼ã‚¹
- ãƒãƒƒãƒå‡¦ç†å®Ÿè£…ï¼ˆAPIå‘¼å‡º99.94%å‰Šæ¸›ï¼‰
- 3æˆ¦ç•¥Q/Aç”Ÿæˆå®Ÿè£…
- é‡ã¿ä»˜ã‘é¡ä¼¼åº¦è¨ˆç®—å®Ÿè£…
- è©³ç´°ã‚«ãƒãƒ¬ãƒƒã‚¸çµ±è¨ˆè¿½åŠ 

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«æº–æ‹ ]

## ä½œæˆè€…

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯`a03_rag_qa_coverage.md`ã‚’å‚è€ƒã«ã€æ”¹è‰¯ç‰ˆã®æŠ€è¡“è©³ç´°ã¨æ€§èƒ½æ”¹å–„ã‚’ä¸­å¿ƒã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚